
// --- Constants & Config ---

const CANVAS_WIDTH = 800;
const CANVAS_HEIGHT = 600;
const TILE_SIZE = 40;
const FPS = 90; // Increased from 60 to 90 (1.5x Speed)

const ELEMENTS = {
    NONE: '無',
    LIGHT: '光',
    DARK: '暗',
    WATER: '水',
    FIRE: '火',
    WIND: '風',
    EARTH: '土',
    POISON: '毒'
};

const ELEMENT_COLORS = {
    '無': '#B0BEC5',
    '光': '#FFF59D',
    '暗': '#7B1FA2',
    '水': '#29B6F6',
    '火': '#EF5350',
    '風': '#26A69A',
    '土': '#8D6E63',
    '毒': '#C6FF00'
};

// Attack Multipliers: attacker -> defender
const ELEMENT_CHART = {
    // Water > Fire > Wind > Earth > Water
    // Light <> Dark
    // Poison > Earth/Water, Poison < Fire/Wind/Light
    // None is neutral
};

// Initialize Chart
for (let k in ELEMENTS) ELEMENT_CHART[ELEMENTS[k]] = {};

function setRel(atk, def, val) { 
    if (ELEMENT_CHART[atk]) {
        ELEMENT_CHART[atk][def] = val; 
    }
}

// Defaults 1.0
Object.values(ELEMENTS).forEach(a => Object.values(ELEMENTS).forEach(d => setRel(a, d, 1.0)));

// Cycle
setRel(ELEMENTS.WATER, ELEMENTS.FIRE, 2.0);
setRel(ELEMENTS.FIRE, ELEMENTS.WATER, 0.5);

setRel(ELEMENTS.FIRE, ELEMENTS.WIND, 2.0);
setRel(ELEMENTS.WIND, ELEMENTS.FIRE, 0.5);

setRel(ELEMENTS.WIND, ELEMENTS.EARTH, 2.0);
setRel(ELEMENTS.EARTH, ELEMENTS.WIND, 0.5);

setRel(ELEMENTS.EARTH, ELEMENTS.WATER, 2.0);
setRel(ELEMENTS.WATER, ELEMENTS.EARTH, 0.5);

// Light / Dark
setRel(ELEMENTS.LIGHT, ELEMENTS.DARK, 2.0);
setRel(ELEMENTS.DARK, ELEMENTS.LIGHT, 2.0);
setRel(ELEMENTS.LIGHT, ELEMENTS.LIGHT, 0.5);
setRel(ELEMENTS.DARK, ELEMENTS.DARK, 0.5);

// Poison Logic
setRel(ELEMENTS.POISON, ELEMENTS.EARTH, 1.5);
setRel(ELEMENTS.POISON, ELEMENTS.WATER, 1.5);
setRel(ELEMENTS.POISON, ELEMENTS.POISON, 0.0); // Immune
setRel(ELEMENTS.FIRE, ELEMENTS.POISON, 1.5); // Burn poison
setRel(ELEMENTS.WIND, ELEMENTS.POISON, 1.5); // Disperse poison

// Path Definition (Grid Coordinates)
// S-Shape
const PATH_POINTS = [
    {x: 0, y: 2},
    {x: 18, y: 2},
    {x: 18, y: 6},
    {x: 1, y: 6},
    {x: 1, y: 10},
    {x: 18, y: 10},
    {x: 18, y: 14}, // End
];

// --- Global State ---

const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const assets = { marmot: new Image() };
assets.marmot.src = 'data:image/png;base64,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';

let game = {
    gold: 600,
    lives: 20,
    wave: 1,
    score: 0,
    speedFactor: 1,
    loopId: null,
    lastTime: 0,
    enemies: [],
    towers: [],
    projectiles: [],
    particles: [],
    waveActive: false,
    waveTimer: 0,
    enemiesToSpawn: 0,
    spawnTimer: 0,
    selectedTower: null, // For UI
    mouseX: 0,
    mouseY: 0,
    autoNextWaveTimer: 0, // Auto start timer
    isGameStarted: false
};

// --- Generators ---

// Generate 20 Tower Types
const TOWER_TYPES = [];
const SHAPES = ['circle', 'square', 'triangle', 'pentagon', 'diamond'];
const ELEMENT_KEYS_ORIGINAL = ['NONE', 'LIGHT', 'DARK', 'WATER', 'FIRE', 'WIND', 'EARTH', 'POISON'];

// Custom Tower Names based on ID/Element
const TOWER_NAMES = [
    // Tier 1 (0-7)
    '鐵甲弩砲',   // NONE
    '光輝守衛',   // LIGHT
    '暗影射手',   // DARK
    '寒冰水晶',   // WATER
    '烈焰砲塔',   // FIRE
    '疾風圖騰',   // WIND
    '堅石堡壘',   // EARTH
    '劇毒噴嘴',   // POISON

    // Tier 2 (8-15)
    '重型加農',   // NONE (Cycle back)
    '天堂之拳',   // LIGHT
    '虛空行者',   // DARK
    '深海巨獸',   // WATER
    '隕石術塔',   // FIRE
    '雷神之錘',   // WIND
    '泰坦之握',   // EARTH
    '腐蝕之沼',   // POISON

    // Tier 3 (16-19)
    '毀滅戰車',   // NONE
    '神聖新星',   // LIGHT
    '狙擊精英',   // DARK (Sniper - ID 18)
    '狂暴機槍'    // WATER (Rapid - ID 19)
];

for (let i = 0; i < 20; i++) {
    const elementKey = ELEMENT_KEYS_ORIGINAL[i % 8];
    const element = ELEMENTS[elementKey];
    const tier = Math.floor(i / 8) + 1; // 1, 2, 3 roughly
    
    // Vary stats based on index to create "classes"
    let range = 3 + (i % 5); // 3 to 7 tiles
    let damage = 10 + (i * 2) + (tier * 5);
    let speed = 60 - (i % 3) * 10; // Frames per shot (lower is faster)
    if (speed < 10) speed = 10;
    let cost = 50 + (i * 25);

    // Special types adjustments
    if (i === 18) { // Sniper
        range = 12; damage = 300; speed = 120; cost = 800;
    }
    if (i === 19) { // Rapid
        range = 4; damage = 5; speed = 5; cost = 600;
    }

    let skill = null;
    let skillDesc = '';
    
    // Assign Skills based on Index/Element
    // 0 Light -> Heal
    if (i === 0 || i === 8) { skill = 'heal'; skillDesc = '治療周圍'; }
    // 2 Water -> Slow (Passive)
    else if (element === ELEMENTS.WATER) { skill = 'slow'; skillDesc = '緩速敵人'; }
    // 3 Fire -> Crit (Passive)
    else if (element === ELEMENTS.FIRE) { skill = 'crit'; skillDesc = '暴擊機率'; }
    // 6 Earth -> Gold (Passive)
    else if (element === ELEMENTS.EARTH) { skill = 'gold'; skillDesc = '生產黃金'; }
    // 7 Poison -> Poison (Passive)
    else if (element === ELEMENTS.POISON) { skill = 'poison'; skillDesc = '毒素傷害'; }
    // 18 Sniper -> Nuke (Active)
    else if (i === 18) { skill = 'nuke'; skillDesc = '主動: 核彈'; }

    TOWER_TYPES.push({
        id: i,
        name: TOWER_NAMES[i] || `${element}塔 MK${tier}`, // Use Custom Name
        element: element,
        range: range * TILE_SIZE,
        damage: damage,
        cooldown: speed,
        cost: cost,
        color: ELEMENT_COLORS[element],
        shape: SHAPES[i % SHAPES.length],
        tier: tier,
        skill: skill,
        skillDesc: skillDesc
    });
}

// Generate 100 Waves - HARDCORE
const WAVES = [];
for (let i = 0; i < 100; i++) {
    const isBoss = (i + 1) % 5 === 0;
    const elementKey = ELEMENT_KEYS_ORIGINAL[(i + 2) % 8];
    const element = ELEMENTS[elementKey];
    // Significantly increased HP scaling
    const baseHP = 150 * Math.pow(1.15, i); // Lowered slightly for 100 levels to prevent infinity
    const count = isBoss ? 3 : (10 + Math.floor(i / 2));
    const speed = 1.0 + (i % 3) * 0.5;
    
    WAVES.push({
        level: i + 1,
        elementKey: elementKey,
        element: element,
        count: count,
        hp: Math.floor(baseHP * (isBoss ? 10 : 1)), // Boss has 10x HP
        speed: isBoss ? speed * 0.5 : speed, // Boss is slower
        interval: isBoss ? 120 : (60 - Math.min(i, 40)),
        reward: (10 + Math.floor(i * 1.5)) * (isBoss ? 10 : 1),
        scale: (0.6 + (i % 4) * 0.1) * (isBoss ? 2.5 : 1), // Boss is huge
        isBoss: isBoss
    });
}
// --- Classes ---

class Enemy {
    constructor(waveIdx) {
        const config = WAVES[waveIdx];
        this.hp = config.hp;
        this.maxHp = config.hp;
        this.speed = config.speed;
        this.element = config.element;
        this.reward = config.reward;
        this.scale = config.scale;
        this.isBoss = config.isBoss;
        
        // Pathing
        this.pathIndex = 0;
        this.x = PATH_POINTS[0].x * TILE_SIZE + TILE_SIZE/2;
        this.y = PATH_POINTS[0].y * TILE_SIZE + TILE_SIZE/2;
        this.targetX = PATH_POINTS[1].x * TILE_SIZE + TILE_SIZE/2;
        this.targetY = PATH_POINTS[1].y * TILE_SIZE + TILE_SIZE/2;
        
        this.frozen = 0;
        this.poisoned = 0;
        this.poisonTimer = 0;
        
        this.attackCooldown = 0;
    }

    update() {
        // Status Effects
        let currentSpeed = this.speed * game.speedFactor;
        if (this.frozen > 0) {
            currentSpeed *= 0.5;
            this.frozen--;
        }
        
        // Regen
        if (this.hp < this.maxHp && Math.random() < 0.01) {
             this.hp += this.maxHp * 0.005;
             if(this.hp > this.maxHp) this.hp = this.maxHp;
        }

        if (this.poisoned > 0) {
            if (this.poisonTimer % 60 === 0) {
                this.hp -= this.poisoned; // damage per second
                game.particles.push(new TextParticle(this.x, this.y, `-${this.poisoned}`, '#76FF03'));
            }
            this.poisonTimer++;
            if (this.hp <= 0) this.die();
        }

        // Attack Nearby Towers (Some enemies)
        // Check for tower in range (e.g., 2 tiles)
        if (this.attackCooldown > 0) this.attackCooldown -= game.speedFactor;
        
        // Simple Logic: If a tower is very close, attack it instead of moving full speed?
        // Or attack while moving. Let's attack while moving.
        if (this.attackCooldown <= 0) {
            const nearbyTower = game.towers.find(t => {
                const dx = t.x - this.x;
                const dy = t.y - this.y;
                return Math.sqrt(dx*dx + dy*dy) < TILE_SIZE * 2;
            });
            
            if (nearbyTower) {
                // Attack!
                nearbyTower.takeDamage(10 * (this.isBoss ? 5 : 1)); // Boss hits hard
                game.projectiles.push(new Projectile(this.x, this.y, nearbyTower, 0, this.element, 5)); // Visual only
                this.attackCooldown = 60; // 1 sec attack rate
            }
        }

        // Movement
        const dx = this.targetX - this.x;
        const dy = this.targetY - this.y;
        const dist = Math.sqrt(dx*dx + dy*dy);

        if (dist <= currentSpeed) {
            this.x = this.targetX;
            this.y = this.targetY;
            this.pathIndex++;
            if (this.pathIndex >= PATH_POINTS.length - 1) {
                this.reachEnd();
            } else {
                this.targetX = PATH_POINTS[this.pathIndex + 1].x * TILE_SIZE + TILE_SIZE/2;
                this.targetY = PATH_POINTS[this.pathIndex + 1].y * TILE_SIZE + TILE_SIZE/2;
            }
        } else {
            this.x += (dx / dist) * currentSpeed;
            this.y += (dy / dist) * currentSpeed;
        }
    }

    draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        
        // Health Bar
        const pct = Math.max(0, this.hp / this.maxHp);
        ctx.fillStyle = 'red';
        ctx.fillRect(-15, -25, 30, 4);
        ctx.fillStyle = '#0f0';
        ctx.fillRect(-15, -25, 30 * pct, 4);

        // Marmot
        const size = 32 * this.scale;
        
        // Elemental Aura / Glow
        ctx.shadowBlur = 15;
        ctx.shadowColor = ELEMENT_COLORS[this.element];
        ctx.strokeStyle = ctx.shadowColor;
        ctx.lineWidth = 3;
        
        ctx.beginPath();
        ctx.arc(0, 0, size/1.5, 0, Math.PI*2);
        ctx.stroke();
        
        ctx.shadowBlur = 0; // Reset

        // Boss Indicator
        if (this.isBoss) {
            ctx.strokeStyle = '#ff0000';
            ctx.lineWidth = 5; // Thicker for boss
            ctx.stroke();
        }

        // Draw Image
        if (assets.marmot.complete) {
            ctx.drawImage(assets.marmot, -size/2, -size/2, size, size);
        }

        ctx.restore();
    }
// ... (rest of class)

    takeDamage(amount, type) {
        const mult = ELEMENT_CHART[type][this.element] || 1.0;
        const finalDmg = amount * mult;
        this.hp -= finalDmg;
        
        // Visual text
        let color = '#fff';
        if (mult > 1.2) color = '#ff0000'; // Crit
        else if (mult < 0.8) color = '#888'; // Weak
        
        if (game.particles.length < 50) { // Limit particles
            game.particles.push(new TextParticle(this.x, this.y - 10, Math.floor(finalDmg), color));
        }

        if (this.hp <= 0) this.die();
    }

    die() {
        this.dead = true;
        game.gold += this.reward;
        game.score += this.reward * 10;
        updateUI();
    }

    reachEnd() {
        this.dead = true;
        game.lives--;
        updateUI();
        if (game.lives <= 0) gameOver();
    }
}

class Tower {
    constructor(typeId, x, y) {
        const type = TOWER_TYPES[typeId];
        this.typeId = typeId;
        this.gridX = x;
        this.gridY = y;
        this.x = x * TILE_SIZE + TILE_SIZE/2;
        this.y = y * TILE_SIZE + TILE_SIZE/2;
        
        this.level = 1;
        this.spent = type.cost;
        this.kills = 0;
        
        // Stats
        this.baseDamage = type.damage;
        this.baseRange = type.range;
        this.baseCooldown = type.cooldown;
        this.element = type.element;
        this.shape = type.shape;
        this.color = type.color;
        this.skill = type.skill;
        
        this.cooldownTimer = 0;
        this.skillTimer = 0; // For passive skills
        this.activeSkillCd = 0; // For active skills

        // Health Logic
        this.maxHp = 100 * type.tier;
        this.hp = this.maxHp;
        this.dead = false;
    }

    getDamage() { return Math.floor(this.baseDamage * Math.pow(1.5, this.level - 1)); }
    
    // Sell Value depends on HP
    getCost() { 
        const baseSell = Math.floor(this.spent * 0.7);
        const hpPct = this.hp / this.maxHp;
        return Math.floor(baseSell * hpPct);
    }
    
    getUpgradeCost() { return Math.floor(TOWER_TYPES[this.typeId].cost * Math.pow(1.5, this.level)); }

    takeDamage(amount) {
        this.hp -= amount;
        game.particles.push(new TextParticle(this.x, this.y - 20, `-${amount}`, '#ff0000'));
        if (this.hp <= 0) {
            this.dead = true;
            game.selectedTower = null; // Deselect if selected
            document.getElementById('selection-info').style.display = 'none';
        }
    }
    
    heal(amount) {
        this.hp += amount;
        if (this.hp > this.maxHp) this.hp = this.maxHp;
        game.particles.push(new TextParticle(this.x, this.y - 20, `+${amount}`, '#00ff00'));
    }

    triggerActiveSkill() {
        if (this.skill === 'nuke' && this.activeSkillCd <= 0) {
             // Find strongest enemy
             let target = null;
             let maxHp = -1;
             for (const enemy of game.enemies) {
                 if (enemy.hp > maxHp) {
                     maxHp = enemy.hp;
                     target = enemy;
                 }
             }
             
             if (target) {
                 target.takeDamage(500 * this.level, this.element); // Massive Damage
                 game.particles.push(new TextParticle(target.x, target.y - 30, "核彈!", '#ff00ff'));
                 // Visual beam
                 game.projectiles.push(new Projectile(this.x, this.y, target, 0, this.element, 20)); 
                 this.activeSkillCd = 600; // 10s cooldown
                 updateTowerInfo(); // Update button state
                 return true;
             } else {
                 showNotification("沒有可攻擊的目標!");
                 return false;
             }
        }
        return false;
    }

    update() {
        if (this.dead) return;
        
        // Passive Regen
        if (this.hp < this.maxHp && Math.random() < 0.01) this.hp++;
        
        // Active Skill CD
        if (this.activeSkillCd > 0) {
             this.activeSkillCd -= game.speedFactor;
             if (this.activeSkillCd < 0) this.activeSkillCd = 0;
             if (game.selectedTower === this && this.activeSkillCd === 0) updateTowerInfo();
        }

        // Passive Skills Logic
        this.skillTimer += game.speedFactor;
        
        if (this.skill === 'gold' && this.skillTimer >= 300) { // 5s
            game.gold += 10;
            game.particles.push(new TextParticle(this.x, this.y - 20, `+$10`, '#ffd700'));
            this.skillTimer = 0;
            updateUI();
        }
        
        if (this.skill === 'heal' && this.skillTimer >= 60) { // 1s
            // Find damaged neighbor
            const neighbor = game.towers.find(t => t !== this && !t.dead && t.hp < t.maxHp && 
                Math.sqrt((t.x-this.x)**2 + (t.y-this.y)**2) <= TILE_SIZE * 3);
            
            if (neighbor) {
                neighbor.heal(5 * this.level);
                // Visual line?
            }
            this.skillTimer = 0;
        }

        if (this.cooldownTimer > 0) {
            this.cooldownTimer -= game.speedFactor;
            return;
        }

        // Find Target
        // Simple logic: First enemy in range
        let target = null;
        let maxDist = 0; // Progress

        for (const enemy of game.enemies) {
            const dx = enemy.x - this.x;
            const dy = enemy.y - this.y;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            if (dist <= this.baseRange) {
                target = enemy;
                break; 
            }
        }

        if (target) {
            this.shoot(target);
            this.cooldownTimer = this.baseCooldown;
        }
    }

    shoot(target) {
        let dmg = this.getDamage();
        let isCrit = false;
        
        if (this.skill === 'crit' && Math.random() < 0.25) { // 25% Crit
            dmg *= 2;
            isCrit = true;
        }

        game.projectiles.push(new Projectile(
            this.x, this.y, target, dmg, this.element, 8, isCrit, this.skill
        ));
    }

    draw() {
        const cx = this.x;
        const cy = this.y;
        
        ctx.fillStyle = '#222';
        ctx.fillRect(this.gridX * TILE_SIZE, this.gridY * TILE_SIZE, TILE_SIZE, TILE_SIZE);
        
        ctx.save();
        ctx.translate(cx, cy);
        
        // Base
        ctx.fillStyle = this.color;
        ctx.strokeStyle = '#fff';
        ctx.lineWidth = 2;
        
        ctx.beginPath();
        if (this.shape === 'circle') ctx.arc(0,0, 15, 0, Math.PI*2);
        else if (this.shape === 'square') ctx.rect(-12,-12, 24, 24);
        else if (this.shape === 'triangle') {
            ctx.moveTo(0, -15); ctx.lineTo(12, 10); ctx.lineTo(-12, 10); ctx.closePath();
        } else {
            ctx.rect(-10,-10, 20, 20); // Default
        }
        ctx.fill();
        ctx.stroke();

        // Level Indicators
        ctx.fillStyle = 'gold';
        for(let i=0; i<this.level; i++) {
            ctx.fillRect(-10 + (i*4), -5, 2, 10);
        }

        // HP Bar (if damaged)
        if (this.hp < this.maxHp) {
            const pct = Math.max(0, this.hp / this.maxHp);
            ctx.fillStyle = 'red';
            ctx.fillRect(-15, 15, 30, 4);
            ctx.fillStyle = '#0f0';
            ctx.fillRect(-15, 15, 30 * pct, 4);
        }

        ctx.restore();
    }
}

class Projectile {
    constructor(x, y, target, damage, element, speed, isCrit = false, skillEffect = null) {
        this.x = x;
        this.y = y;
        this.target = target;
        this.damage = damage;
        this.element = element;
        this.speed = speed;
        this.isCrit = isCrit;
        this.skillEffect = skillEffect;
        this.dead = false;
    }

    update() {
        if (this.target.dead) {
            this.dead = true;
            return;
        }

        const dx = this.target.x - this.x;
        const dy = this.target.y - this.y;
        const dist = Math.sqrt(dx*dx + dy*dy);
        const move = this.speed * game.speedFactor;

        if (dist <= move) {
            this.target.takeDamage(this.damage, this.element);
            if (this.isCrit) {
                 game.particles.push(new TextParticle(this.target.x, this.target.y - 15, "暴擊!", '#ff0000'));
            }
            this.dead = true;
            
            // Special Effects based on Element/Skill
            if (this.element === ELEMENTS.WATER || this.skillEffect === 'slow') this.target.frozen = 60; // Slow 1s
            if (this.element === ELEMENTS.POISON || this.skillEffect === 'poison') {
                this.target.poisoned = 20; // Dmg/sec
                this.target.poisonTimer = 0;
            }

        } else {
            this.x += (dx/dist) * move;
            this.y += (dy/dist) * move;
        }
    }

    draw() {
        ctx.fillStyle = ELEMENT_COLORS[this.element];
        ctx.beginPath();
        const size = this.isCrit ? 6 : 4;
        ctx.arc(this.x, this.y, size, 0, Math.PI*2);
        ctx.fill();
    }
}

class TextParticle {
    constructor(x, y, text, color) {
        this.x = x;
        this.y = y;
        this.text = text;
        this.color = color;
        this.life = 30;
    }
    update() {
        this.y -= 1 * game.speedFactor;
        this.life -= game.speedFactor;
    }
    draw() {
        ctx.globalAlpha = this.life / 30;
        ctx.fillStyle = this.color;
        ctx.font = '12px Arial';
        ctx.fillText(this.text, this.x, this.y);
        ctx.globalAlpha = 1.0;
    }
}

// --- Engine ---

function init() {
    // Generate UI
    const list = document.getElementById('towers-list');
    TOWER_TYPES.forEach(t => {
        const div = document.createElement('div');
        div.className = 'tower-card';
        div.innerHTML = `
            <div class="tower-icon" style="background:${t.color}; border-radius:50%;"></div>
            <strong>${t.name.split(' ')[0]}</strong>
            <span class="element-badge" style="background:${t.color}33;">${t.element}</span>
            <div style="margin-top:2px;">$${t.cost}</div>
        `;
        div.onclick = () => selectTowerToBuild(t.id);
        list.appendChild(div);
    });

    // Event Listeners
    canvas.addEventListener('mousedown', onCanvasClick);
    document.getElementById('start-wave-btn').addEventListener('click', startNextWave);
    document.getElementById('speed-btn').addEventListener('click', toggleSpeed);
    document.getElementById('upgrade-btn').addEventListener('click', upgradeSelected);
    document.getElementById('sell-btn').addEventListener('click', sellSelected);
    
    // Mouse Move for Cursor
    canvas.addEventListener('mousemove', onCanvasMouseMove);

    // Initial Draw
    updateUI();
    draw();
    
    // Start Loop
    requestAnimationFrame(gameLoop);
}

function gameLoop(timestamp) {
    if (!game.lastTime) game.lastTime = timestamp;
    const delta = timestamp - game.lastTime;

    if (delta >= 1000 / (FPS * (game.speedFactor === 2 ? 2 : 1))) {
        update();
        draw();
        game.lastTime = timestamp;
    }
    
    game.loopId = requestAnimationFrame(gameLoop);
}

function update() {
    if (game.lives <= 0) return;


    // Wave Spawning
    if (game.waveActive) {
        if (game.enemiesToSpawn > 0) {
            game.spawnTimer -= game.speedFactor;
            if (game.spawnTimer <= 0) {
                const config = WAVES[game.wave - 1];
                game.enemies.push(new Enemy(game.wave - 1));
                game.enemiesToSpawn--;
                game.spawnTimer = config.interval;
            }
        } else if (game.enemies.length === 0) {
            endWave();
        }
    } else if (game.isGameStarted && game.autoNextWaveTimer > 0) {
        // Auto Next Wave Countdown
        game.autoNextWaveTimer -= (1 / FPS) * game.speedFactor;
        if (game.autoNextWaveTimer <= 0) {
            game.autoNextWaveTimer = 0;
            startNextWave();
        } else {
            // Update UI for Countdown
             const btn = document.getElementById('start-wave-btn');
             btn.textContent = `下一波 (${Math.ceil(game.autoNextWaveTimer)}s)`;
        }
    }

    // Entities
    game.enemies.forEach(e => e.update());
    // Filter dead enemies (handled inside update to allow "die" logic to run)
    game.enemies = game.enemies.filter(e => !e.dead);

    game.towers.forEach(t => t.update());
    // Filter destroyed towers
    game.towers = game.towers.filter(t => !t.dead);
    
    game.projectiles.forEach(p => p.update());
    game.projectiles = game.projectiles.filter(p => !p.dead);
    
    game.particles.forEach(p => p.update());
    game.particles = game.particles.filter(p => p.life > 0);
}

function draw() {
    // Canvas Resizing Logic
    const wrapper = document.getElementById('canvas-wrapper');
    const targetWidth = wrapper.clientWidth;
    const targetHeight = wrapper.clientHeight;
    
    // Update internal size to match display size for crisp rendering
    if (canvas.width !== targetWidth || canvas.height !== targetHeight) {
        canvas.width = targetWidth;
        canvas.height = targetHeight;
    }

    // Clear
    ctx.fillStyle = '#111';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Calculate Scale to fit the 800x600 logical game into the current canvas
    // We want to "contain" the game board
    const scaleX = canvas.width / CANVAS_WIDTH;
    const scaleY = canvas.height / CANVAS_HEIGHT;
    const scale = Math.min(scaleX, scaleY);
    
    const offsetX = (canvas.width - CANVAS_WIDTH * scale) / 2;
    const offsetY = (canvas.height - CANVAS_HEIGHT * scale) / 2;

    ctx.save();
    ctx.translate(offsetX, offsetY);
    ctx.scale(scale, scale);

    // Draw Background/Board Area
    ctx.fillStyle = '#333';
    ctx.fillRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);

    // Draw Path
    ctx.strokeStyle = '#555';
    ctx.lineWidth = TILE_SIZE;
    ctx.lineCap = 'round';
    ctx.lineJoin = 'round';
    ctx.beginPath();
    ctx.moveTo(PATH_POINTS[0].x * TILE_SIZE + TILE_SIZE/2, PATH_POINTS[0].y * TILE_SIZE + TILE_SIZE/2);
    for(let i=1; i<PATH_POINTS.length; i++) {
        ctx.lineTo(PATH_POINTS[i].x * TILE_SIZE + TILE_SIZE/2, PATH_POINTS[i].y * TILE_SIZE + TILE_SIZE/2);
    }
    ctx.stroke();

    // Draw Grid (Optional, faint)
    ctx.strokeStyle = '#444';
    ctx.lineWidth = 1;
    for(let i=0; i<=CANVAS_WIDTH; i+=TILE_SIZE) {
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, CANVAS_HEIGHT); ctx.stroke();
    }
    for(let i=0; i<=CANVAS_HEIGHT; i+=TILE_SIZE) {
        ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(CANVAS_WIDTH, i); ctx.stroke();
    }

    // Entities
    game.towers.forEach(t => t.draw());
    game.enemies.forEach(e => e.draw());
    game.projectiles.forEach(p => p.draw());
    game.particles.forEach(p => p.draw());

    // Highlight Selected
    if (game.selectedTower) {
        const t = game.selectedTower;
        ctx.strokeStyle = '#ffca28';
        ctx.lineWidth = 2;
        ctx.strokeRect(t.gridX*TILE_SIZE, t.gridY*TILE_SIZE, TILE_SIZE, TILE_SIZE);
        
        // Range
        ctx.beginPath();
        ctx.arc(t.x, t.y, t.baseRange, 0, Math.PI*2);
        ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
        ctx.fill();
        ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
        ctx.stroke();
    }
    
    // Ghost Tower (Build Mode)
    if (buildModeId !== null) {
         // Get mouse pos from global state if tracked, or we can just rely on the fact 
         // that we need to track mouse for this feature properly.
         // Let's use the game.mouseX/Y we declared earlier but haven't used yet.
         // Or simpler: use the last known mouse position from onCanvasMouseMove
         
         if (game.mouseX && game.mouseY) {
            const gx = Math.floor(game.mouseX / TILE_SIZE);
            const gy = Math.floor(game.mouseY / TILE_SIZE);
            
            if (gx >= 0 && gx < CANVAS_WIDTH/TILE_SIZE && gy >= 0 && gy < CANVAS_HEIGHT/TILE_SIZE) {
                const cx = gx * TILE_SIZE + TILE_SIZE/2;
                const cy = gy * TILE_SIZE + TILE_SIZE/2;
                const type = TOWER_TYPES[buildModeId];

                // Draw Ghost Range
                ctx.beginPath();
                ctx.arc(cx, cy, type.range, 0, Math.PI*2);
                ctx.fillStyle = 'rgba(255, 255, 255, 0.1)';
                ctx.fill();
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.stroke();
                
                // Draw Ghost Tower (Semi-transparent)
                ctx.globalAlpha = 0.5;
                ctx.fillStyle = type.color;
                ctx.beginPath();
                // Simple shape rep
                ctx.arc(cx, cy, 15, 0, Math.PI*2); 
                ctx.fill();
                ctx.globalAlpha = 1.0;
                
                // Color indication if valid
                const valid = !isPath(gx, gy) && !game.towers.find(t => t.gridX === gx && t.gridY === gy);
                ctx.fillStyle = valid ? 'rgba(0, 255, 0, 0.3)' : 'rgba(255, 0, 0, 0.3)';
                ctx.fillRect(gx * TILE_SIZE, gy * TILE_SIZE, TILE_SIZE, TILE_SIZE);
            }
         }
    }

    ctx.restore();
}

// --- Interaction ---

let buildModeId = null;

function showNotification(msg) {
    const overlay = document.getElementById('notification-overlay');
    const div = document.createElement('div');
    div.className = 'notification';
    div.textContent = msg;
    overlay.appendChild(div);
    setTimeout(() => {
        if (div.parentNode) div.parentNode.removeChild(div);
    }, 3000);
}

function selectTowerToBuild(id) {
    if (game.gold >= TOWER_TYPES[id].cost) {
        buildModeId = id;
        game.selectedTower = null;
        updateUI();
        document.body.style.cursor = 'crosshair';
        showNotification(`已選擇 ${TOWER_TYPES[id].name}。請點擊地圖建造。`);
    } else {
        showNotification("金錢不足!");
    }
}

function onCanvasClick(e) {
    const rect = canvas.getBoundingClientRect();
    
    // Reverse Scale Calculation
    const scaleX = canvas.width / CANVAS_WIDTH;
    const scaleY = canvas.height / CANVAS_HEIGHT;
    const scale = Math.min(scaleX, scaleY);
    const offsetX = (canvas.width - CANVAS_WIDTH * scale) / 2;
    const offsetY = (canvas.height - CANVAS_HEIGHT * scale) / 2;

    const clickX = e.clientX - rect.left - offsetX;
    const clickY = e.clientY - rect.top - offsetY;

    const gameX = clickX / scale;
    const gameY = clickY / scale;

    // Check Enemy Click (Tap Damage)
    for (let i = game.enemies.length - 1; i >= 0; i--) {
        const e = game.enemies[i];
        // Hitbox approx 30px radius scaled
        const dist = Math.sqrt((e.x - gameX) ** 2 + (e.y - gameY) ** 2);
        if (dist < 30 * e.scale) { 
            const clickDmg = 10 + (game.wave * 5); // Base 10 + 5 per wave
            e.takeDamage(clickDmg, ELEMENTS.NONE);
            game.particles.push(new TextParticle(e.x, e.y - 40, "點擊!", '#ffffff'));
            return; // Handled click
        }
    }

    const x = Math.floor(gameX / TILE_SIZE);
    const y = Math.floor(gameY / TILE_SIZE);

    // Validate bounds
    if (x < 0 || x >= CANVAS_WIDTH/TILE_SIZE || y < 0 || y >= CANVAS_HEIGHT/TILE_SIZE) return;

    // Check collision with path
    if (isPath(x, y)) {
         showNotification("不能建造在路徑上!");
         return;
    }

    // Check existing tower
    const existing = game.towers.find(t => t.gridX === x && t.gridY === y);

    if (buildModeId !== null) {
        if (!existing) {
            // Build
            const type = TOWER_TYPES[buildModeId];
            if (game.gold >= type.cost) {
                game.gold -= type.cost;
                game.towers.push(new Tower(buildModeId, x, y));
                buildModeId = null;
                document.body.style.cursor = 'default';
                updateUI();
                showNotification("防禦塔建造完成!");
            }
        } else {
            showNotification("該位置已被佔用!");
        }
    } else {
        if (existing) {
            game.selectedTower = existing;
            updateTowerInfo();
        } else {
            game.selectedTower = null;
            document.getElementById('selection-info').style.display = 'none';
        }
    }
}

function onCanvasMouseMove(e) {
    const rect = canvas.getBoundingClientRect();
    const scaleX = canvas.width / CANVAS_WIDTH;
    const scaleY = canvas.height / CANVAS_HEIGHT;
    const scale = Math.min(scaleX, scaleY);
    const offsetX = (canvas.width - CANVAS_WIDTH * scale) / 2;
    const offsetY = (canvas.height - CANVAS_HEIGHT * scale) / 2;

    const mouseX = e.clientX - rect.left - offsetX;
    const mouseY = e.clientY - rect.top - offsetY;

    const gameX = mouseX / scale;
    const gameY = mouseY / scale;

    // Save for draw() loop
    game.mouseX = gameX;
    game.mouseY = gameY;

    if (buildModeId !== null) return; // Keep crosshair if building

    let hoveringEnemy = false;
    for (const e of game.enemies) {
        const dist = Math.sqrt((e.x - gameX) ** 2 + (e.y - gameY) ** 2);
        if (dist < 30 * e.scale) {
            hoveringEnemy = true;
            break;
        }
    }

    if (hoveringEnemy) {
        document.body.style.cursor = 'pointer';
    } else {
        document.body.style.cursor = 'default';
    }
}

function isPath(x, y) {
    // Simple segment check
    for(let i=0; i<PATH_POINTS.length-1; i++) {
        const p1 = PATH_POINTS[i];
        const p2 = PATH_POINTS[i+1];
        
        const minX = Math.min(p1.x, p2.x);
        const maxX = Math.max(p1.x, p2.x);
        const minY = Math.min(p1.y, p2.y);
        const maxY = Math.max(p1.y, p2.y);

        if (x >= minX && x <= maxX && y >= minY && y <= maxY) return true;
    }
    return false;
}

// --- Game Flow ---

function startNextWave() {
    if (game.waveActive || game.wave > 100) return;
    
    game.waveActive = true;
    game.autoNextWaveTimer = 0; // Clear timer
    const config = WAVES[game.wave - 1];
    game.enemiesToSpawn = config.count;
    game.spawnTimer = 0;
    
    const btn = document.getElementById('start-wave-btn');
    btn.disabled = true;
    btn.textContent = "波次進行中...";
    updateUI();
}

function endWave() {
    game.waveActive = false;
    game.wave++;
    
    // Wave Bonus
    const bonus = 100 + (game.wave * 25);
    game.gold += bonus;
    showNotification(`波次完成! 獲得 +$${bonus} 金幣。 塔樓已修復。`);
    
    // Heal/Buff Towers
    game.towers.forEach(t => {
        t.maxHp += 10;
        t.hp += 20;
        if(t.hp > t.maxHp) t.hp = t.maxHp;
    });

    if (game.wave > 100) {
        showNotification("勝利! 100關全破!");
        game.wave = 100; // Cap
    } else {
        // Start Auto Timer
        game.autoNextWaveTimer = 10; // 10 seconds
        document.getElementById('start-wave-btn').disabled = false;
    }
    updateUI();
}

function gameOver() {
    showNotification("遊戲結束 - 重新載入...");
    setTimeout(() => location.reload(), 3000);
}

function toggleSpeed() {
    game.speedFactor = game.speedFactor === 1 ? 2 : 1;
    const btn = document.getElementById('speed-btn');
    btn.textContent = game.speedFactor + 'x 速度';
    btn.className = game.speedFactor === 2 ? 'x2' : '';
}

function upgradeSelected() {
    const t = game.selectedTower;
    if (!t) return;
    const cost = t.getUpgradeCost();
    if (game.gold >= cost) {
        game.gold -= cost;
        t.level++;
        t.spent += cost;
        updateUI();
        updateTowerInfo();
    }
}

function sellSelected() {
    const t = game.selectedTower;
    if (!t) return;
    game.gold += t.getCost();
    game.towers = game.towers.filter(tower => tower !== t);
    game.selectedTower = null;
    document.getElementById('selection-info').style.display = 'none';
    updateUI();
}

// --- UI Updates ---

function startGame() {
    document.getElementById('splash-screen').style.display = 'none';
    game.isGameStarted = true;
    game.autoNextWaveTimer = 10; // Start Countdown for Wave 1
    updateUI();
}

function updateUI() {
    document.getElementById('gold-display').textContent = game.gold;
    document.getElementById('lives-display').textContent = game.lives;
    document.getElementById('wave-display').textContent = `${game.wave} / 100`;
    document.getElementById('score-display').textContent = game.score;

    // Next Wave Info
    if (game.wave <= 100) {
        const next = WAVES[game.wave - 1];
        document.getElementById('next-wave-details').innerHTML = `
            屬性: <span style="color:${ELEMENT_COLORS[next.element]}">${next.element}</span><br>
            數量: ${next.count}<br>
            血量: ${next.hp}
        `;
    } else {
        document.getElementById('next-wave-details').textContent = "全數通關!";
    }
}

function updateTowerInfo() {
    const t = game.selectedTower;
    if (!t) return;
    
    const info = document.getElementById('selection-info');
    info.style.display = 'block';
    
    document.getElementById('sel-name').textContent = TOWER_TYPES[t.typeId].name;
    document.getElementById('sel-type').textContent = t.element;
    document.getElementById('sel-hp').textContent = `${Math.floor(t.hp)}/${t.maxHp}`;
    document.getElementById('sel-dmg').textContent = t.getDamage();
    document.getElementById('sel-speed').textContent = t.baseCooldown;
    document.getElementById('sel-range').textContent = t.baseRange / TILE_SIZE;
    document.getElementById('sel-level').textContent = t.level;
    
    // Skill info
    const skillRow = document.getElementById('skill-row');
    const skillSpan = document.getElementById('sel-skill');
    const skillBtn = document.getElementById('cast-skill-btn');
    
    const type = TOWER_TYPES[t.typeId];
    if (type.skill) {
        skillRow.style.display = 'flex';
        skillSpan.textContent = type.skillDesc;
        
        if (type.skill === 'nuke') {
            skillBtn.style.display = 'block';
            if (t.activeSkillCd > 0) {
                skillBtn.disabled = true;
                skillBtn.textContent = `冷卻中 (${Math.ceil(t.activeSkillCd/60)}s)`;
                skillBtn.style.background = '#555';
            } else {
                skillBtn.disabled = false;
                skillBtn.textContent = "主動: 核彈 (就緒)";
                skillBtn.style.background = '#7b1fa2';
                skillBtn.onclick = () => {
                    if (t.triggerActiveSkill()) {
                        // Success
                    }
                };
            }
        } else {
            skillBtn.style.display = 'none';
        }
    } else {
        skillRow.style.display = 'none';
        skillBtn.style.display = 'none';
    }
    
    document.getElementById('upg-cost').textContent = t.getUpgradeCost();
    document.getElementById('sell-cost').textContent = t.getCost();
}

// Boot
window.onload = init;
